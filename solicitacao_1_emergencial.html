<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solicitação de Itens - EMERGENCIAL</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: url('images/background.png') no-repeat center center fixed;
    background-size: cover;
    position: relative;
  }
  .background2-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100px;
    background: url('images/background2.png') no-repeat center bottom;
    background-size: contain;
    z-index: 0;
  }
  .estoque {
    background: rgba(255, 255, 255, 0.9);
    padding: 30px 40px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    max-width: 900px;
    width: 95%;
    z-index: 1;
    position: relative;
  }
  .titulo {
    text-align: center;
    font-size: 26px;
    margin-bottom: 20px;
    font-weight: 700;
  }
  h3 {
    margin-top: 30px;
    font-size: 30px;
    color: #333;
    text-align: left;
    position: relative;
    padding-bottom: 5px;
  }
  h3::after {
    content: "";
    display: block;
    width: 100%;
    height: 3px;
    background: #007bff;
    margin-top: 5px;
    border-radius: 2px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    text-align: center;
    margin-bottom: 20px;
  }
  th, td {
    padding: 8px 10px;
    border: 1px solid #333;
  }
  th {
    background: #f0f0f0;
    font-weight: 600;
  }
  input[type="number"] {
    width: 80px;
    padding: 5px;
    text-align: center;
  }
  .botoes-formulario {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
  }
  .botoes-formulario button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 5px;
  }
  .botoes-formulario button[type="submit"] {
    background-color: #007bff;
    color: white;
    border: none;
  }
  .botoes-formulario button[type="button"] {
    background-color: #f0f0f0;
    border: 1px solid #ccc;
  }
</style>
</head>
<body>
<div class="background2-footer"></div>

<section class="estoque" id="estoque">
  <h2 class="titulo">SOLICITAÇÃO DE ITENS - EMERGENCIAL</h2>

  <!-- MEDICAMENTOS -->
  <h3>MEDICAMENTOS</h3>
  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th>Quantidade a Solicitar</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>AAS</td><td><input type="number" min="0" value=""></td></tr>
      <tr><td>ACETILCISTEÍNA 300MG</td><td><input type="number" min="0" value=""></td></tr>
      <tr><td>ADENOSINA 3MG</td><td><input type="number" min="0" value=""></td></tr>
      <tr><td>ADENOSINA 6MG</td><td><input type="number" min="0" value=""></td></tr>
      <tr><td>ÁGUA PARA INJETÁVEIS</td><td><input type="number" min="0" value=""></td></tr>
    </tbody>
  </table>

  <!-- MATERIAIS FARMÁCIA -->
  <h3>MATERIAIS FARMÁCIA</h3>
  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th>Quantidade a Solicitar</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Equipo bomba</td><td><input type="number" min="0" value=""></td></tr>
      <tr><td>Equipo micro</td><td><input type="number" min="0" value=""></td></tr>
      <tr><td>Equipo macro</td><td><input type="number" min="0" value=""></td></tr>
      <tr><td>Equipo top</td><td><input type="number" min="0" value=""></td></tr>
    </tbody>
  </table>

  <!-- PRODUTOS DE LIMPEZA -->
  <h3>PRODUTOS DE LIMPEZA</h3>
  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th>Quantidade a Solicitar</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Álcool 70%</td><td><input type="number" min="0" value=""></td></tr>
      <tr><td>Água sanitária</td><td><input type="number" min="0" value=""></td></tr>
      <tr><td>Detergente neutro</td><td><input type="number" min="0" value=""></td></tr>
    </tbody>
  </table>

  <!-- PRODUTOS ALIMENTÍCIO -->
  <h3>PRODUTOS ALIMENTÍCIO</h3>
  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th>Quantidade a Solicitar</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Água mineral</td><td><input type="number" min="0" value=""></td></tr>
      <tr><td>Pão de forma</td><td><input type="number" min="0" value=""></td></tr>
      <tr><td>Leite</td><td><input type="number" min="0" value=""></td></tr>
    </tbody>
  </table>

  <form action="https://script.google.com/macros/s/AKfycbz7WHdAgQ2EubOBKRlFJsnILNIStkUUSGE0P375vvowv1Y--wU1FgldHXayr_S0WmGO/exec" method="post" id="form_solicitacao">
    <input type="hidden" name="data" id="data_solicitacao">
    <div class="botoes-formulario">
      <button type="button" onclick="window.location.href='mensal_emergencial.html'">Voltar</button>
      <button type="submit">Enviar</button>
    </div>
  </form>
</section>


<script>
document.querySelector('#form_solicitacao').addEventListener('submit', function(e){
  e.preventDefault();
  
  const tabelas = document.querySelectorAll('table tbody');
  const itens = [];

  // percorre todas as tabelas e linhas
  tabelas.forEach(tbody => {
    tbody.querySelectorAll('tr').forEach(row => {
      const item = row.cells[0].textContent; // <-- aqui deixamos explícito que é "item"
      const quantidade = parseInt(row.querySelector('input').value) || 0;

      if (quantidade > 0) {
        itens.push({ item, quantidade });
      }
    });
  });

  if (itens.length === 0) {
    alert('Nenhum item preenchido para envio.');
    return;
  }

  // pega os dados do usuário do localStorage
  const base = localStorage.getItem('cidadeSelecionada') || '';
  const nome = localStorage.getItem('nome') || '';
  const cpf = localStorage.getItem('cpf') || '';
  const coren = localStorage.getItem('coren') || '';
  const data = localStorage.getItem('data') || '';

  // monta o JSON final com BASE, NOME, CPF, COREN, DATA, ITEM, QUANTIDADE
  const dadosParaEnviar = itens.map(d => ({
    base,
    nome,
    cpf,
    coren,
    data,
    item: d.item,
    quantidade: d.quantidade
  }));

  // atribui ao input hidden
  document.getElementById('data_solicitacao').value = JSON.stringify(dadosParaEnviar);

  // envia o formulário
  this.submit();

  // reseta todos os inputs após enviar
  tabelas.forEach(tbody => {
    tbody.querySelectorAll('input').forEach(input => input.value = '');
  });
});
</script>



</script>
</body>
</html>
